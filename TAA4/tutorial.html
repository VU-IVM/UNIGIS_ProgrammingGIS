

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>TAA4: Accessibility to healthcare facilities &#8212; UNIGIS - Big Data in Sustainability Science</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'TAA4/tutorial';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Tutorial 3: Accessing web-hosted geo-data and clustering" href="../TAA3/tutorial.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="UNIGIS - Big Data in Sustainability Science - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="UNIGIS - Big Data in Sustainability Science - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Course overview</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../course_basics/course_intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../course_basics/teachers.html">Teachers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../course_basics/schedule.html">Course schedule</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 1</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../week1/tutorial1.html">Tutorial 1: Introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week1/tutorial2.html">Tutorial 2: Introduction to NumPy and Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week1/tutorial3.html">Tutorial 3: Introduction to Data Analysis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">TAA1</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../TAA1/lecture.html">Lecture: Introduction to Statistical Learning on Geospatial Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../TAA1/tutorial.html">Tutorial 1: Land-cover classification</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">TAA2</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../TAA2/lecture.html">Lecture: Big Data in the public domain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../TAA2/tutorial.html">TAA2: Natural Hazard Risk Assessment using Open Data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">TAA3</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../TAA3/lecture.html">Lecture: Loading API geodata and clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../TAA3/tutorial.html">Tutorial 3: Accessing web-hosted geo-data and clustering</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">TAA4</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">TAA4: Accessibility to healthcare facilities</a></li>

</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/VU-IVM/UNIGIS_ProgrammingGIS/blob/main/TAA4/tutorial.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/VU-IVM/UNIGIS_ProgrammingGIS" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/VU-IVM/UNIGIS_ProgrammingGIS/issues/new?title=Issue%20on%20page%20%2FTAA4/tutorial.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/TAA4/tutorial.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>TAA4: Accessibility to healthcare facilities</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">TAA4: Accessibility to healthcare facilities</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#important-before-we-start">Important before we start</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-objectives">Learning Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prepare-the-packages">Prepare the packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-download-and-preparation">2. Data download and preparation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#classification-of-rural-and-urban-areas">3. Classification of rural and urban areas</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up">Set-up</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-training-validation-data">Set-up training &amp; validation data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-image-variables-to-include">Calculate image variables to include</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-clc2018-and-sample-data">Load CLC2018 and sample data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optimize-on-training-validation-set">Optimize on training &amp; validation set</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#run-on-test-set">Run on test set</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#export-resulting-image">Export resulting image</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#overlay-urban-and-rural-classification-with-population-and-healthcare-information">3. Overlay urban and rural classification with population and Healthcare information</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#clustering-population-data-points-and-assigning-them-to-their-nearest-hospital">4. Clustering population data points and assigning them to their nearest hospital.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#explore-and-evaluate-baseline-results">5. Explore and evaluate baseline results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#identify-and-plot-population-per-healthcare-facility">Identify and plot population per healthcare facility</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#natural-hazard-disruption">6. Natural hazard disruption</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-flood-data">Download flood data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#overlay-flood-data-with-hospitals">Overlay flood data with Hospitals</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#overlay-flood-data-with-healthcare-facilities">Overlay flood data with healthcare facilities</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#your-final-task">7. Your Final Task</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#your-task-here-will-be">Your task here will be:</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="taa4-accessibility-to-healthcare-facilities">
<h1>TAA4: Accessibility to healthcare facilities<a class="headerlink" href="#taa4-accessibility-to-healthcare-facilities" title="Permalink to this heading">#</a></h1>
<p>In this tutorial, we wrap up what you have learned in TAA1-3 by demonstrating their applications and connections. For a European country of your choice, we collect data on the population and their health facilities. Using a classification method, we add rural and urban features to the population data points. Then, with a clustering algorithm, we group population points based on their coordinates and assign each cluster to its closest hospitals. This allows us to calculate the total urban and rural demand for each hospital. Next, we assess the impact of flooding on the hospitals, distinguishing between damaged and undamaged facilities.</p>
<p>In the aftermath of the flood, the number of hospitals in service has changed. Your task will be to repeat the clustering process, assign the new clusters to the intact hospitals, and then calculate their urban and rural demand in the post-flood conditions.</p>
<section id="important-before-we-start">
<h2>Important before we start<a class="headerlink" href="#important-before-we-start" title="Permalink to this heading">#</a></h2>
<hr class="docutils" />
<p>Make sure that you save this file before you continue, else you will lose everything. To do so, go to <strong>Bestand/File</strong> and click on <strong>Een kopie opslaan in Drive/Save a Copy on Drive</strong>!</p>
</section>
<section id="learning-objectives">
<h2>Learning Objectives<a class="headerlink" href="#learning-objectives" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>To extract, prepare and manipulate geospatial information</p></li>
<li><p>To run a classification algorithm to identify urban and rural land use.</p></li>
<li><p>To overlay raster and vector information.</p></li>
<li><p>To cluster different geospatial layers.</p></li>
<li><p>To visualise geospatial information.</p></li>
</ul>
<hr>
</section>
<section id="prepare-the-packages">
<h2>Prepare the packages<a class="headerlink" href="#prepare-the-packages" title="Permalink to this heading">#</a></h2>
<hr><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>-q<span class="w"> </span>rasterio<span class="w"> </span>rioxarray<span class="w"> </span>contextily<span class="w"> </span>osm_flex<span class="w"> </span>exact_extract
</pre></div>
</div>
</div>
</div>
<p>Now we will import these packages in the cell below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Standard Library Imports</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">zipfile</span> <span class="kn">import</span> <span class="n">ZipFile</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>

<span class="c1"># Data Manipulation and Analysis</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">rioxarray</span> <span class="k">as</span> <span class="nn">rxr</span>

<span class="c1"># Machine Learning</span>
<span class="kn">import</span> <span class="nn">sklearn</span>  <span class="c1"># General import if other sklearn modules are needed</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>

<span class="c1"># Geometry and Spatial Analysis</span>
<span class="kn">import</span> <span class="nn">shapely</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span>
<span class="kn">import</span> <span class="nn">rasterio</span> <span class="k">as</span> <span class="nn">rio</span>
<span class="kn">from</span> <span class="nn">rasterio.enums</span> <span class="kn">import</span> <span class="n">Resampling</span>
<span class="kn">from</span> <span class="nn">scipy.spatial.distance</span> <span class="kn">import</span> <span class="n">cdist</span>

<span class="c1"># Earth Engine and Geospatial Libraries</span>
<span class="kn">import</span> <span class="nn">ee</span>
<span class="kn">import</span> <span class="nn">geemap</span>
<span class="kn">import</span> <span class="nn">contextily</span> <span class="k">as</span> <span class="nn">cx</span>
<span class="kn">import</span> <span class="nn">osm_flex</span>
<span class="kn">from</span> <span class="nn">osm_flex</span> <span class="kn">import</span> <span class="n">download</span>
<span class="kn">from</span> <span class="nn">exactextract</span> <span class="kn">import</span> <span class="n">exact_extract</span>

<span class="c1"># Visualization</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">contextily</span> <span class="k">as</span> <span class="nn">ctx</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>  
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">clear_output</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-download-and-preparation">
<h2>2. Data download and preparation<a class="headerlink" href="#data-download-and-preparation" title="Permalink to this heading">#</a></h2>
<p>Define a country of your interest and a size for gridding and a randomSeed</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">country_full_name</span> <span class="o">=</span> <span class="s1">&#39;Slovenia&#39;</span>
<span class="n">country_iso3</span> <span class="o">=</span> <span class="s1">&#39;SVN&#39;</span>
<span class="n">upscale_factor</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1">#Km</span>

<span class="c1">### Set global seeds ###</span>
<span class="n">random_seed</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PYTHONHASHSEED&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<p>Here, we download the population data from WorldPop, an open source platform. Select the country of interest from the WorldPop <a class="reference external" href="https://hub.worldpop.org/geodata/listing?id=62">website</a> and add the link to the URL below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://data.worldpop.org/GIS/Population/Global_2000_2020/2018/0_Mosaicked/ppp_2018_1km_Aggregated.tif&quot;</span>

<span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;ppp_2018_1km_Aggregated.tif&#39;</span>

<span class="c1">#open(file_name, &#39;wb&#39;).write(requests.get(url).content)</span>

<span class="n">file_name</span> <span class="o">=</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Data</span><span class="se">\\</span><span class="s2">Global_Geospatial</span><span class="se">\\</span><span class="s2">worldpop</span><span class="se">\\</span><span class="s2">ppp_2018_1km_Aggregated.tif&quot;</span>


<span class="n">world_pop_glob</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span><span class="n">engine</span><span class="o">=</span><span class="s1">&#39;rasterio&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<p>Now, we use a file with country borders from Natural Earth, to get boundries of the country of your interest.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">world</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;https://github.com/nvkelso/natural-earth-vector/raw/master/10m_cultural/ne_10m_admin_0_countries.shp&quot;</span><span class="p">)</span>
<span class="c1"># And we want to take the country boundaries and geometry</span>
<span class="n">country_bounds</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">world</span><span class="o">.</span><span class="n">ADM0_ISO</span> <span class="o">==</span> <span class="n">country_iso3</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span>
<span class="n">country_geom</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">world</span><span class="o">.</span><span class="n">ADM0_ISO</span> <span class="o">==</span> <span class="n">country_iso3</span><span class="p">]</span><span class="o">.</span><span class="n">geometry</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">country_geom</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>103    POLYGON ((13.64292 45.45943, 13.64282 45.45945...
Name: geometry, dtype: geometry
</pre></div>
</div>
</div>
</div>
<p>Now, we use the derived boundries to clip the population data from worldpop, to get the population of our coutnry.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># clip to country</span>
<span class="n">world_pop_national</span> <span class="o">=</span> <span class="n">world_pop_glob</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">clip_box</span><span class="p">(</span><span class="n">minx</span><span class="o">=</span><span class="n">country_bounds</span><span class="o">.</span><span class="n">minx</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                     <span class="n">miny</span><span class="o">=</span><span class="n">country_bounds</span><span class="o">.</span><span class="n">miny</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                     <span class="n">maxx</span><span class="o">=</span><span class="n">country_bounds</span><span class="o">.</span><span class="n">maxx</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                     <span class="n">maxy</span><span class="o">=</span><span class="n">country_bounds</span><span class="o">.</span><span class="n">maxy</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span>
<span class="n">world_pop_national</span> <span class="o">=</span> <span class="n">world_pop_national</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">country_geom</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">world_pop_glob</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<p>The worldpop data, however, is stored as 1km by 1km grid. This will be too computationally intensive if we would use that resolution. As such, we reproject the to a lower resolution. This will help us to perform the analyis more smoothly. We use the <em>upscale_factor</em> as defined at the start of this subsection.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">world_pop_national</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">upscale_factor</span><span class="p">)</span>
<span class="n">new_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">world_pop_national</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="n">upscale_factor</span><span class="p">)</span>

<span class="n">worldpop_Grided</span> <span class="o">=</span> <span class="n">world_pop_national</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">reproject</span><span class="p">(</span>
    <span class="n">world_pop_national</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
    <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">new_height</span><span class="p">,</span> <span class="n">new_width</span><span class="p">),</span>
    <span class="n">resampling</span><span class="o">=</span><span class="n">Resampling</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<p>Now we remove the missing data from our data points and create a GeoDataFrame for our country.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_worldpop_</span> <span class="o">=</span> <span class="n">worldpop_Grided</span><span class="o">.</span><span class="n">band_data</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
<span class="n">df_worldpop_</span> <span class="o">=</span> <span class="n">df_worldpop_</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">df_worldpop_</span><span class="o">.</span><span class="n">band_data</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># create geometry values and drop lat lon columns</span>
<span class="n">df_worldpop_</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shapely</span><span class="o">.</span><span class="n">points</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">df_worldpop_</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span><span class="n">df_worldpop_</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]))))</span>

<span class="n">df_worldpop_</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">df_worldpop_</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;spatial_ref&#39;</span><span class="p">,</span><span class="s1">&#39;band&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># dynamically create a variable name for the DataFrame</span>
<span class="nb">globals</span><span class="p">()[</span><span class="sa">f</span><span class="s1">&#39;df_pop_</span><span class="si">{</span><span class="n">country_iso3</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">df_worldpop_</span><span class="p">)</span>

<span class="c1"># dynamically create a print statement that reflects the current country code</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The output is df_pop_</span><span class="si">{</span><span class="n">country_iso3</span><span class="si">}</span><span class="s2"> as a dataframe of the population data of </span><span class="si">{</span><span class="n">country_full_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The output is df_pop_SVN as a dataframe of the population data of Slovenia
</pre></div>
</div>
</div>
</div>
<p>And Lets plot the population points of our country of interest</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="sa">f</span><span class="s1">&#39;df_pop_</span><span class="si">{</span><span class="n">country_iso3</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Population Points of </span><span class="si">{</span><span class="n">country_full_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><img alt="../_images/67322a24f20f051d332c80e71cd4520057ace590cbece734182e90be43367400.png" src="../_images/67322a24f20f051d332c80e71cd4520057ace590cbece734182e90be43367400.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="nb">globals</span><span class="p">()[</span><span class="sa">f</span><span class="s1">&#39;df_pop_</span><span class="si">{</span><span class="n">country_iso3</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>396
</pre></div>
</div>
</div>
</div>
<p>Our next step is to extract information of healthcare facilities for the country of interest. We do so using OpenStreetMap. With the latest version of geopandas, it is now possible to directly read <strong>osm.pbf</strong> files from OpenStreetMap.</p>
<p>Healthcare facilities are stored as <em>multipolygons</em> within OpenStreetMap, and we want to download all clinics and hospitals.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">Country_GeofabrikData_path</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">get_country_geofabrik</span><span class="p">(</span><span class="n">country_iso3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: total: 0 ns
Wall time: 0 ns
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">HealthCenters</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">Country_GeofabrikData_path</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;multipolygons&quot;</span><span class="p">)</span>
<span class="n">sub_types</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;clinic&#39;</span><span class="p">,</span> <span class="s1">&#39;hospital&#39;</span><span class="p">]</span>
<span class="n">HealthCenters</span> <span class="o">=</span> <span class="n">HealthCenters</span><span class="p">[</span><span class="n">HealthCenters</span><span class="p">[</span><span class="s1">&#39;amenity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">sub_types</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">HealthCenters</span> <span class="o">=</span> <span class="n">HealthCenters</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">3857</span><span class="p">)</span>

<span class="c1"># to convert polygons to their centroids</span>
<span class="n">HealthCenters_centroids</span> <span class="o">=</span> <span class="n">HealthCenters</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">HealthCenters_centroids</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HealthCenters</span><span class="o">.</span><span class="n">centroid</span>

<span class="n">HealthCenters_centroids</span><span class="o">=</span><span class="n">HealthCenters_centroids</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\eks510\.conda\envs\pygis\Lib\site-packages\pyogrio\raw.py:196: RuntimeWarning: Non closed ring detected. To avoid accepting it, set the OGR_GEOMETRY_ACCEPT_UNCLOSED_RING configuration option to NO
  return ogr_read(
</pre></div>
</div>
</div>
</div>
<p>Let’s check the content of our generated HealthCenters_centroids GeoDataFrame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">HealthCenters</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>osm_id</th>
      <th>osm_way_id</th>
      <th>name</th>
      <th>type</th>
      <th>aeroway</th>
      <th>amenity</th>
      <th>admin_level</th>
      <th>barrier</th>
      <th>boundary</th>
      <th>building</th>
      <th>...</th>
      <th>man_made</th>
      <th>military</th>
      <th>natural</th>
      <th>office</th>
      <th>place</th>
      <th>shop</th>
      <th>sport</th>
      <th>tourism</th>
      <th>other_tags</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>16172</td>
      <td>None</td>
      <td>Porodnišnica Ljubljana</td>
      <td>multipolygon</td>
      <td>None</td>
      <td>hospital</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>hospital</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>"addr:city"=&gt;"Ljubljana","addr:housenumber"=&gt;"...</td>
      <td>MULTIPOLYGON (((1616891.57 5788942.854, 161685...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1735820</td>
      <td>None</td>
      <td>REHA Radkersburg Klinik Maria Theresia</td>
      <td>multipolygon</td>
      <td>None</td>
      <td>clinic</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>yes</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>"addr:city"=&gt;"Bad Radkersburg","addr:housenumb...</td>
      <td>MULTIPOLYGON (((1778635.005 5891252.415, 17786...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2226607</td>
      <td>None</td>
      <td>Univerzitetni rehabilitacijski inštitut Republ...</td>
      <td>multipolygon</td>
      <td>None</td>
      <td>hospital</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>hospital</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>"addr:city"=&gt;"Ljubljana","addr:housenumber"=&gt;"...</td>
      <td>MULTIPOLYGON (((1616842.545 5791255.347, 16168...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3449006</td>
      <td>None</td>
      <td>Zdravstveni dom Ljubljana - Rudnik</td>
      <td>multipolygon</td>
      <td>None</td>
      <td>clinic</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>yes</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>"addr:city"=&gt;"Ljubljana","addr:housenumber"=&gt;"...</td>
      <td>MULTIPOLYGON (((1616791.327 5786197.784, 16167...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5229321</td>
      <td>None</td>
      <td>Psihiatrična bolnišnica</td>
      <td>multipolygon</td>
      <td>None</td>
      <td>hospital</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>yes</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>"addr:city"=&gt;"Begunje na Gorenjskem","addr:hou...</td>
      <td>MULTIPOLYGON (((1580944.926 5840918.384, 15808...</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 26 columns</p>
</div></div></div>
</div>
<p>And let’s visualize the hospitals locations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The output is HealthCenters_centroids as a dataframe of the Health Centers&quot;</span><span class="p">)</span>

<span class="c1">#plotting</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">HealthCenters_centroids</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="c1"># temporarily reprojects to EPSG:3857 to add the basemap (contextily requires it)</span>
<span class="c1">#cx.add_basemap(ax, crs=&#39;EPSG:4326&#39;, source=cx.providers.OpenStreetMap.Mapnik, zoom=8)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Locations of Hospitals and Clinics in </span><span class="si">{</span><span class="n">country_full_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The output is HealthCenters_centroids as a dataframe of the Health Centers
</pre></div>
</div>
<img alt="../_images/6c8e5d7592be7eddda1687be6c138f6ee51bb184a62faadc1a61b787d9dd5663.png" src="../_images/6c8e5d7592be7eddda1687be6c138f6ee51bb184a62faadc1a61b787d9dd5663.png" />
</div>
</div>
</section>
<section id="classification-of-rural-and-urban-areas">
<h2>3. Classification of rural and urban areas<a class="headerlink" href="#classification-of-rural-and-urban-areas" title="Permalink to this heading">#</a></h2>
<p>As you remember, we checked the content of the population data, and there was no information regarding urban or rural areas. Therefore, we need to add this information to our dataset. So, we will use an approach similar to what you learned in TAA1, but for the sake of processing efficiency, we will use Earth Engine’s built-in classifier packages rather than scikit-learn. In this situation we are interested in only two land cover classes: rural and urban. We will have to reclassify the raster, train a model to distinguish between these timesteps, and finally perform the classification on recent images.</p>
<!--  -->
<p>We have pre-filled most of the code in this section, and you will use a few new tricks to perform the classification. Beyond that, we challenge you to leverage what you have learned in TAA1 to improve the performance of the model, by any means you see fit. You will be evaluated on your reasoning, as well as the creativity of the approaches.</p>
<section id="set-up">
<h3>Set-up<a class="headerlink" href="#set-up" title="Permalink to this heading">#</a></h3>
<p>First, set up your Earth Engine environment as you did before.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ee</span><span class="o">.</span><span class="n">Authenticate</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ee</span><span class="o">.</span><span class="n">Initialize</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="s2">&quot;proj-gis-1234&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
</section>
<section id="set-up-training-validation-data">
<h3>Set-up training &amp; validation data<a class="headerlink" href="#set-up-training-validation-data" title="Permalink to this heading">#</a></h3>
<p>We will make use of the following data sources:</p>
<ol class="arabic simple">
<li><p>Administrative country boundary to clip to the area of interest</p></li>
<li><p>Sentinel-2 satellite images at 10x10m resolution</p></li>
<li><p>CORINE Land Cover (CLC)</p></li>
</ol>
<p>For the satellite image, we take the S2 median image over the summer to improve sensitivity to single-capture conditions. The median image is taken over the summer, so that we exclude seasonal dynamics. Finally, we clip this image to the country extent.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the region of interest (ROI)</span>
<span class="n">country_ROI</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">(</span><span class="s2">&quot;FAO/GAUL/2015/level0&quot;</span><span class="p">)</span> \
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="s1">&#39;ADM0_NAME&#39;</span><span class="p">,</span> <span class="n">country_full_name</span><span class="p">))</span>

<span class="c1"># Load Sentinel-2 Image Collection</span>
<span class="n">sentinel2</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="s2">&quot;COPERNICUS/S2_HARMONIZED&quot;</span><span class="p">)</span> \
             <span class="o">.</span><span class="n">filterBounds</span><span class="p">(</span><span class="n">country_ROI</span><span class="o">.</span><span class="n">geometry</span><span class="p">())</span> \
             <span class="o">.</span><span class="n">filterDate</span><span class="p">(</span><span class="s1">&#39;2018-06-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-31&#39;</span><span class="p">)</span> \
             <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="s1">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Create a median composite to reduce cloud cover</span>
<span class="n">mosaic_image</span> <span class="o">=</span> <span class="n">sentinel2</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">country_ROI</span><span class="o">.</span><span class="n">geometry</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<p>Show on map to verify that it’s loaded</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bands</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;B4&#39;</span><span class="p">,</span> <span class="s1">&#39;B3&#39;</span><span class="p">,</span> <span class="s1">&#39;B2&#39;</span><span class="p">]</span> <span class="c1"># Fill in this list yourself</span>
<span class="n">vis_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mi">3000</span><span class="p">,</span> <span class="s1">&#39;bands&#39;</span><span class="p">:</span> <span class="n">bands</span><span class="p">}</span>  <span class="c1"># Limit upper range so you can see detail</span>

<span class="nb">map</span> <span class="o">=</span> <span class="n">geemap</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

<span class="c1"># dynamically center the map on the selected country (ROI)</span>
<span class="nb">map</span><span class="o">.</span><span class="n">centerObject</span><span class="p">(</span><span class="n">country_ROI</span><span class="o">.</span><span class="n">geometry</span><span class="p">(),</span> <span class="mi">8</span><span class="p">)</span>

<span class="c1"># adding the mosaic image layer for the selected country</span>
<span class="nb">map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">mosaic_image</span><span class="p">,</span> <span class="n">vis_params</span><span class="p">,</span> <span class="s2">&quot;Sentinel-2_2018&quot;</span><span class="p">)</span>

<span class="nb">map</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><script type="application/vnd.jupyter.widget-view+json">{"model_id": "1397cb265f0847a09763b85957dcf482", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
<section id="calculate-image-variables-to-include">
<h3>Calculate image variables to include<a class="headerlink" href="#calculate-image-variables-to-include" title="Permalink to this heading">#</a></h3>
<p>Next, we will compute variables to use for our classifier. We have provided the examples you’ve already seen for TAA1, but we challenge you to add your own variables. You can get inspiration from anywhere, but be sure that you are able to explain the reasoning behind including each variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_s2_variables</span><span class="p">(</span><span class="n">s2_image</span><span class="p">):</span>
    <span class="c1"># Calculate additional spectral indices</span>
    <span class="n">dvi</span> <span class="o">=</span> <span class="n">s2_image</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;B5&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">s2_image</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;B4&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;DVI&#39;</span><span class="p">)</span>
    <span class="n">ndvi</span> <span class="o">=</span> <span class="n">s2_image</span><span class="o">.</span><span class="n">normalizedDifference</span><span class="p">([</span><span class="s1">&#39;B5&#39;</span><span class="p">,</span> <span class="s1">&#39;B4&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;NDVI&#39;</span><span class="p">)</span>
    <span class="n">ndwi</span> <span class="o">=</span> <span class="n">s2_image</span><span class="o">.</span><span class="n">normalizedDifference</span><span class="p">([</span><span class="s1">&#39;B3&#39;</span><span class="p">,</span> <span class="s1">&#39;B5&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;NDWI&#39;</span><span class="p">)</span>

    <span class="c1"># Add indices to the image</span>
    <span class="n">s2_image</span> <span class="o">=</span> <span class="n">s2_image</span><span class="o">.</span><span class="n">addBands</span><span class="p">([</span><span class="n">dvi</span><span class="p">,</span> <span class="n">ndvi</span><span class="p">,</span> <span class="n">ndwi</span><span class="p">])</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">       ToDo: Add your own variables!</span>

<span class="sd">       Think about what you learned in TAA1 - how else can you compute information</span>
<span class="sd">       from the spectral bands to include? Look at some papers for inspiration,</span>
<span class="sd">       or try something out yourself. There&#39;s more than just indices that can help here!</span>

<span class="sd">       Don&#39;t forget to add them to the image after you create them!</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">### TEACHER EXAMPLE - REMOVE BEFORE GOES LIVE. ###</span>

    <span class="c1"># Define neighborhood size (e.g., 3x3)</span>
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Kernel</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Calculate neighborhood statistics</span>
    <span class="n">neighborhood_vars</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;DVI&#39;</span><span class="p">,</span> <span class="s1">&#39;NDVI&#39;</span><span class="p">,</span> <span class="s1">&#39;NDWI&#39;</span><span class="p">]:</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">s2_image</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">band</span><span class="p">)</span><span class="o">.</span><span class="n">reduceNeighborhood</span><span class="p">(</span>
            <span class="n">reducer</span><span class="o">=</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
            <span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span>
        <span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s1">_mean&#39;</span><span class="p">)</span>

        <span class="n">std_dev</span> <span class="o">=</span> <span class="n">s2_image</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">band</span><span class="p">)</span><span class="o">.</span><span class="n">reduceNeighborhood</span><span class="p">(</span>
            <span class="n">reducer</span><span class="o">=</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">stdDev</span><span class="p">(),</span>
            <span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span>
        <span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s1">_stdDev&#39;</span><span class="p">)</span>

        <span class="c1"># Add additional statistics here, such as min, max, etc., if desired.</span>

        <span class="c1"># Append neighborhood bands to the list</span>
        <span class="n">neighborhood_vars</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">mean</span><span class="p">,</span> <span class="n">std_dev</span><span class="p">])</span>

    <span class="c1"># Add neighborhood statistics to the image</span>
    <span class="n">s2_image</span> <span class="o">=</span> <span class="n">s2_image</span><span class="o">.</span><span class="n">addBands</span><span class="p">(</span><span class="n">neighborhood_vars</span><span class="p">)</span>

    <span class="c1">### End of teaching example ###</span>

    <span class="k">return</span> <span class="n">s2_image</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mosaic_image</span> <span class="o">=</span> <span class="n">make_s2_variables</span><span class="p">(</span><span class="n">mosaic_image</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use these bands for prediction</span>
<span class="c1"># DON&#39;T FORGET to add your own variables when you make them!</span>
<span class="n">bands</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;B2&#39;</span><span class="p">,</span> <span class="s1">&#39;B3&#39;</span><span class="p">,</span> <span class="s1">&#39;B4&#39;</span><span class="p">,</span> <span class="s1">&#39;B5&#39;</span><span class="p">,</span> <span class="s1">&#39;B6&#39;</span><span class="p">,</span> <span class="s1">&#39;B7&#39;</span><span class="p">]</span>
<span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NDVI&#39;</span><span class="p">,</span> <span class="s1">&#39;DVI&#39;</span><span class="p">]</span>
<span class="n">img_bands</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">bands</span><span class="p">,</span> <span class="o">*</span><span class="n">indices</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
</section>
<section id="load-clc2018-and-sample-data">
<h3>Load CLC2018 and sample data<a class="headerlink" href="#load-clc2018-and-sample-data" title="Permalink to this heading">#</a></h3>
<p>Now, let’s load labels from CORINE and classify the model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CLC</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="s1">&#39;COPERNICUS/CORINE/V20/100m/2018&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;landcover&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">mosaic_image</span><span class="o">.</span><span class="n">geometry</span><span class="p">())</span>
<span class="n">lc_points</span> <span class="o">=</span> <span class="n">CLC</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
    <span class="o">**</span><span class="p">{</span>
        <span class="s1">&#39;region&#39;</span><span class="p">:</span> <span class="n">mosaic_image</span><span class="o">.</span><span class="n">geometry</span><span class="p">(),</span>
        <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
        <span class="s1">&#39;numPixels&#39;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span> <span class="c1"># Change this as you see fit</span>
        <span class="s1">&#39;seed&#39;</span><span class="p">:</span> <span class="n">random_seed</span><span class="p">,</span>
        <span class="s1">&#39;geometries&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<p>Next, let’s reclassify the dataset to a binary urban/rural dataset. The choice how to do this is yours, and can be as easy or complicated as you like it to be. As a reminder, CLC consists of a <a class="reference external" href="https://land.copernicus.eu/content/corine-land-cover-nomenclature-guidelines/html/">3-digit hierarchy</a>, so you can pick which classes you want to include and exclude.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generalize_clc_class</span><span class="p">(</span><span class="n">feature</span><span class="p">):</span>
    <span class="n">lc_value</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;landcover&#39;</span><span class="p">))</span>

    <span class="c1"># Check if the first character is &#39;1&#39;</span>
    <span class="n">set_value</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Algorithms</span><span class="o">.</span><span class="n">If</span><span class="p">(</span><span class="n">lc_value</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Set the new binary value for the &#39;landcover&#39; property</span>
    <span class="k">return</span> <span class="n">feature</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;landcover&#39;</span><span class="p">,</span> <span class="n">set_value</span><span class="p">)</span>
<span class="n">lc_reference_pts</span> <span class="o">=</span> <span class="n">lc_points</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">generalize_clc_class</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<p><strong>Q: Briefly explain which classes you included for the urban/rural re-classification.</strong></p>
<p>Let’s make training/validation splits. You can customize this however you see fit, but we suggest balanced sampling, where you control how many positive and how many negative samples are included during training/validation, so as to not over/under-sample one or the other.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the land cover labels column</span>
<span class="n">label_col</span> <span class="o">=</span> <span class="s1">&#39;landcover&#39;</span>

<span class="c1">## TEACHING EXAMPLE, REMOVE BEFORE GOING LIVE ##</span>
<span class="c1"># Filter points by label</span>
<span class="n">positive_points</span> <span class="o">=</span> <span class="n">lc_reference_pts</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">label_col</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">negative_points</span> <span class="o">=</span> <span class="n">lc_reference_pts</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">label_col</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Allow a maximum of 2-to-1 difference in negative vs positive class sampling</span>
<span class="n">positive_sample</span> <span class="o">=</span> <span class="n">positive_points</span><span class="o">.</span><span class="n">randomColumn</span><span class="p">(</span><span class="s1">&#39;random&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">positive_points</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
<span class="n">negative_sample</span> <span class="o">=</span> <span class="n">negative_points</span><span class="o">.</span><span class="n">randomColumn</span><span class="p">(</span><span class="s1">&#39;random&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">positive_points</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>

<span class="c1"># Merge the samples</span>
<span class="n">balanced_sample</span> <span class="o">=</span> <span class="n">positive_sample</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">negative_sample</span><span class="p">)</span>

<span class="c1">## End of teaching example ##</span>

<span class="c1"># Split into training and validation sets</span>
<span class="n">training_sample</span> <span class="o">=</span> <span class="n">balanced_sample</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s1">&#39;random &lt;= 0.8&#39;</span><span class="p">)</span>
<span class="n">validation_sample</span> <span class="o">=</span> <span class="n">balanced_sample</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s1">&#39;random &gt; 0.8&#39;</span><span class="p">)</span>

<span class="c1"># Sample regions for training and validation datasets</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">mosaic_image</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">img_bands</span><span class="p">)</span><span class="o">.</span><span class="n">sampleRegions</span><span class="p">(</span>
    <span class="n">collection</span><span class="o">=</span><span class="n">training_sample</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">[</span><span class="n">label_col</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>

<span class="n">val_data</span> <span class="o">=</span> <span class="n">mosaic_image</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">img_bands</span><span class="p">)</span><span class="o">.</span><span class="n">sampleRegions</span><span class="p">(</span>
    <span class="n">collection</span><span class="o">=</span><span class="n">validation_sample</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">[</span><span class="n">label_col</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<p><strong>Q: Describe your sampling approach. Which approach did you go with, and what is the rationale behind it?</strong></p>
</section>
<section id="optimize-on-training-validation-set">
<h3>Optimize on training &amp; validation set<a class="headerlink" href="#optimize-on-training-validation-set" title="Permalink to this heading">#</a></h3>
<p>Now that we have sampled data, we will iteratively improve the model. How you want to approach this is up to you, we only provide the basic process here. In TAA1 we taught you a few methods and concepts that you can build on. To give some suggestions:</p>
<ol class="arabic simple">
<li><p>Analyze the confusion matrix</p></li>
<li><p>Look at different metrics that might be more informative - for instance, precision and recall</p></li>
<li><p>Look at redundant variables - you learned this in scikit-learn, but EE has options for this too if you want to search for it.</p></li>
</ol>
<p>It’s up to you how to approach this, but we recommend to document what worked and what didn’t work so that you have an easier time reporting your results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Train the model</span>
<span class="n">classifier</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Classifier</span><span class="o">.</span><span class="n">smileRandomForest</span><span class="p">(</span><span class="n">numberOfTrees</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">minLeafPopulation</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">maxNodes</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">trained_classifier</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">train_data</span><span class="p">,</span> <span class="n">classProperty</span><span class="o">=</span><span class="n">label_col</span><span class="p">,</span> <span class="n">inputProperties</span><span class="o">=</span><span class="n">img_bands</span><span class="p">)</span>

<span class="c1"># Apply the classifier to the validation data</span>
<span class="n">classified_val</span> <span class="o">=</span> <span class="n">val_data</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">trained_classifier</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<p>Now, let’s analyze your results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate metrics</span>
<span class="n">confusion_matrix</span> <span class="o">=</span> <span class="n">classified_val</span><span class="o">.</span><span class="n">errorMatrix</span><span class="p">(</span><span class="n">label_col</span><span class="p">,</span> <span class="s1">&#39;classification&#39;</span><span class="p">)</span>
<span class="n">val_accuracy</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="o">.</span><span class="n">accuracy</span><span class="p">()</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="o">.</span><span class="n">kappa</span><span class="p">()</span>

<span class="c1"># Package all metrics into a single dictionary</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">({</span>
    <span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="n">val_accuracy</span><span class="p">,</span>
    <span class="s1">&#39;Kappa&#39;</span><span class="p">:</span> <span class="n">kappa</span>
<span class="p">})</span>

<span class="c1"># Retrieve all metrics in one call</span>
<span class="n">metrics_info</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>

<span class="c1"># Print all metrics</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Validation Metrics:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy: </span><span class="si">{</span><span class="n">metrics_info</span><span class="p">[</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Kappa: </span><span class="si">{</span><span class="n">metrics_info</span><span class="p">[</span><span class="s1">&#39;Kappa&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Validation Metrics:
Accuracy: 0.8556701030927835
Kappa: 0.6687804878048779
</pre></div>
</div>
</div>
</div>
<p><strong>Q: Describe the changes you made to the ‘standard’ approach.</strong></p>
<ol class="arabic simple">
<li><p><strong>Why did you make these changes</strong></p></li>
<li><p><strong>which impact did each change have on your analysis?</strong></p></li>
<li><p><strong>Which things did you try that did not work out?</strong></p></li>
</ol>
</section>
<section id="run-on-test-set">
<h3>Run on test set<a class="headerlink" href="#run-on-test-set" title="Permalink to this heading">#</a></h3>
<p>Now, we load recent test images to classify recent urban extent. We take a median image over August 2024.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load Sentinel-2 Image Collection</span>
<span class="n">test_sentinel2</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="s2">&quot;COPERNICUS/S2_HARMONIZED&quot;</span><span class="p">)</span> \
             <span class="o">.</span><span class="n">filterBounds</span><span class="p">(</span><span class="n">country_ROI</span><span class="o">.</span><span class="n">geometry</span><span class="p">())</span> \
             <span class="o">.</span><span class="n">filterDate</span><span class="p">(</span><span class="s1">&#39;2024-08-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2024-08-31&#39;</span><span class="p">)</span> \
             <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="s1">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Create a median composite to reduce cloud cover</span>
<span class="n">test_mosaic_image</span> <span class="o">=</span> <span class="n">sentinel2</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">country_ROI</span><span class="o">.</span><span class="n">geometry</span><span class="p">())</span>

<span class="c1"># Add variables</span>
<span class="n">test_mosaic_image</span> <span class="o">=</span> <span class="n">make_s2_variables</span><span class="p">(</span><span class="n">test_mosaic_image</span><span class="p">)</span>

<span class="c1"># Add to map object</span>
<span class="nb">map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">test_mosaic_image</span><span class="p">,</span> <span class="n">vis_params</span><span class="p">,</span> <span class="s2">&quot;test-Sentinel-2-2024&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<p>Let’s visualize the results calculated over the entire test image</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Classify the test image</span>
<span class="n">classified_image</span> <span class="o">=</span> <span class="n">test_mosaic_image</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">trained_classifier</span><span class="p">)</span>

<span class="c1"># Define the color mapping dictionary</span>
<span class="n">clc_colors</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;#FFFFFF&#39;</span><span class="p">,</span> <span class="c1"># Rural</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;#000000&#39;</span><span class="p">,</span> <span class="c1"># Urban</span>
<span class="p">}</span>

<span class="c1"># Convert string labels to numeric codes</span>
<span class="k">def</span> <span class="nf">classify_to_numeric</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
    <span class="c1"># Create a dictionary that maps string labels to numeric values</span>
    <span class="n">label_to_numeric</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clc_colors</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>

    <span class="c1"># Convert string label to numeric value</span>
    <span class="k">return</span> <span class="n">image</span><span class="o">.</span><span class="n">remap</span><span class="p">(</span>
        <span class="nb">list</span><span class="p">(</span><span class="n">label_to_numeric</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
        <span class="nb">list</span><span class="p">(</span><span class="n">label_to_numeric</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="p">)</span>

<span class="c1"># Convert the classified image</span>
<span class="n">numeric_classified_image</span> <span class="o">=</span> <span class="n">classify_to_numeric</span><span class="p">(</span><span class="n">classified_image</span><span class="p">)</span>

<span class="c1"># Generate a palette for visualization</span>
<span class="n">palette</span> <span class="o">=</span> <span class="p">[</span><span class="n">clc_colors</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">clc_colors</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>

<span class="c1"># Add the numeric classified image to the map</span>
<span class="nb">map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">numeric_classified_image</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="n">palette</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">clc_colors</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">},</span> <span class="s1">&#39;Classified Image&#39;</span><span class="p">)</span>
<span class="nb">map</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><script type="application/vnd.jupyter.widget-view+json">{"model_id": "1397cb265f0847a09763b85957dcf482", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p>There are no metrics to calculate here - after all, we’re trying to update our reference data. Instead, visually evaluate if you’re happy with the results. When you’re happy with the results, proceed to the next block to export the data from Earth Engine into our local environment.</p>
<p>(<strong>hint:</strong> don’t go for perfect, this is very hard to achieve in the current setting)</p>
<p><strong>Q: Describe your map and your results in general.</strong></p>
<ol class="arabic simple">
<li><p><strong>Where do you still see errors? Are these systemic?</strong></p></li>
<li><p><strong>How could you further improve your product to clean these up?</strong> <strong>bold text</strong></p></li>
<li><p><strong>Was there anything you wanted to try, but were unable to?</strong></p></li>
</ol>
</section>
<section id="export-resulting-image">
<h3>Export resulting image<a class="headerlink" href="#export-resulting-image" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geemap</span><span class="o">.</span><span class="n">ee_export_image</span><span class="p">(</span><span class="n">classified_image</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;urban_rural_raster.tif&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">file_per_band</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">urban_raster</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;urban_rural_raster.tif&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;rasterio&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generating URL ...
Downloading data from https://earthengine.googleapis.com/v1/projects/proj-gis-1234/thumbnails/5318c58b433613d47dc90c8602bd6264-893516433a0289f1d648527a6e51611d:getPixels
Please wait ...
Data downloaded to C:\projects\UNIGIS_ProgrammingGIS\TAA4\urban_rural_raster.tif
</pre></div>
</div>
</div>
</div>
</section>
<section id="overlay-urban-and-rural-classification-with-population-and-healthcare-information">
<h3>3. Overlay urban and rural classification with population and Healthcare information<a class="headerlink" href="#overlay-urban-and-rural-classification-with-population-and-healthcare-information" title="Permalink to this heading">#</a></h3>
<p>In this step, we overlay the resulting urban/rural raster image from the previous section onto our population data point. a binary categorical variable, unban_rural, will be added to each data point, where 1 represents urban and 0 represents rural.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">urban_rural</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataarray</span><span class="p">(</span><span class="s1">&#39;urban_rural_raster.tif&#39;</span><span class="p">)</span>

<span class="n">values</span> <span class="o">=</span> <span class="n">urban_rural</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="n">urban_rural</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">x_dim</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">df_worldpop_</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span><span class="p">),</span>
                    <span class="n">urban_rural</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">y_dim</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">df_worldpop_</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">y</span><span class="p">),</span>
                <span class="p">},</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">df_worldpop_</span><span class="p">[</span><span class="s2">&quot;urban_rural&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
<span class="n">df_worldpop_</span><span class="p">[</span><span class="s2">&quot;urban_rural&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_worldpop_</span><span class="p">[</span><span class="s2">&quot;urban_rural&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<p>lets check the resulted calssified population, as mentioned about 1 measn urban and 0 rural.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_worldpop_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>band_data</th>
      <th>geometry</th>
      <th>urban_rural</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>512.969238</td>
      <td>POINT (15.96057 46.8236)</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3930.664307</td>
      <td>POINT (16.04593 46.8236)</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2205.554199</td>
      <td>POINT (16.13129 46.8236)</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1943.986572</td>
      <td>POINT (16.21666 46.8236)</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>836.774170</td>
      <td>POINT (16.30202 46.8236)</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>391</th>
      <td>101.199600</td>
      <td>POINT (15.02161 45.4589)</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>392</th>
      <td>446.684387</td>
      <td>POINT (15.10697 45.4589)</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>393</th>
      <td>1087.734619</td>
      <td>POINT (15.19233 45.4589)</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>394</th>
      <td>1046.664062</td>
      <td>POINT (15.27769 45.4589)</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>395</th>
      <td>155.921677</td>
      <td>POINT (15.36305 45.4589)</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>396 rows × 3 columns</p>
</div></div></div>
</div>
</section>
</section>
<section id="clustering-population-data-points-and-assigning-them-to-their-nearest-hospital">
<h2>4. Clustering population data points and assigning them to their nearest hospital.<a class="headerlink" href="#clustering-population-data-points-and-assigning-them-to-their-nearest-hospital" title="Permalink to this heading">#</a></h2>
<p>In this section, we first add a local_ID to all hospitals to make sure each one has a uniqe id to be refered to later. then we create clusters of population. in this regard, we use K-means clustering algorithm with k equal to the numebr of hospitals. then calculate the sum of rural population each cluster as well as the urban population.  then we calcualte the eucleadin distance of each center of cluster to all hospitals and assinge the hospila that has the minimum distance to them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">HealthCenters_centroids</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>133
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### 1st step: Add Local_ID to the HealthCenters_centroids GeoDataFrame</span>
<span class="n">HealthCenters_centroids</span><span class="p">[</span><span class="s1">&#39;Local_ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">HealthCenters_centroids</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># 2nd step: Ensure both GeoDataFrames are in the same CRS (EPSG:4326)</span>
<span class="n">HealthCenters_centroids</span> <span class="o">=</span> <span class="n">HealthCenters_centroids</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span>

<span class="c1"># Convert geometries to a list of coordinates (for KMeans)</span>
<span class="n">pop_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">geom</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">geom</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">geom</span> <span class="ow">in</span> <span class="n">df_worldpop_</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]])</span>
<span class="n">pop_band_data</span> <span class="o">=</span> <span class="n">df_worldpop_</span><span class="p">[</span><span class="s1">&#39;band_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Extract the hospital coordinates</span>
<span class="n">hospital_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">geom</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">geom</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">geom</span> <span class="ow">in</span> <span class="n">HealthCenters_centroids</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]])</span>
<span class="n">hospital_local_ids</span> <span class="o">=</span> <span class="n">HealthCenters_centroids</span><span class="p">[</span><span class="s1">&#39;Local_ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">hospital_geometries</span> <span class="o">=</span> <span class="n">HealthCenters_centroids</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1">### 3rd step: K-Means</span>
<span class="c1"># Ensure that the number of clusters is equal to the number of hospital coordinates</span>
<span class="n">n_clusters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hospital_coords</span><span class="p">)</span>

<span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">n_clusters</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_seed</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">hospital_coords</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># using hospital locations as initial centers</span>
<span class="n">df_worldpop_</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">pop_coords</span><span class="p">)</span>

<span class="c1"># Get cluster centers (latitude &amp; longitude)</span>
<span class="n">cluster_centers</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span>

<span class="c1">### 4th step: calculate the sum of urban and rural populations in each cluster</span>
<span class="c1"># group by cluster and urban/rural status then sum up the populations</span>

<span class="c1"># rural population (urban_rural = 0)</span>
<span class="n">rural_population_by_cluster</span> <span class="o">=</span> <span class="n">df_worldpop_</span><span class="p">[</span><span class="n">df_worldpop_</span><span class="p">[</span><span class="s1">&#39;urban_rural&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;cluster&#39;</span><span class="p">)[</span><span class="s1">&#39;band_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_clusters</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># urban population (urban_rural = 1)</span>
<span class="n">urban_population_by_cluster</span> <span class="o">=</span> <span class="n">df_worldpop_</span><span class="p">[</span><span class="n">df_worldpop_</span><span class="p">[</span><span class="s1">&#39;urban_rural&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;cluster&#39;</span><span class="p">)[</span><span class="s1">&#39;band_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_clusters</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># to create a new DataFrame for clusters with the total urban and rural population</span>
<span class="n">clusters_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;cluster&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_clusters</span><span class="p">),</span>
    <span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">cluster_centers</span><span class="p">],</span>
    <span class="s1">&#39;urban_population&#39;</span><span class="p">:</span> <span class="n">urban_population_by_cluster</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="s1">&#39;rural_population&#39;</span><span class="p">:</span> <span class="n">rural_population_by_cluster</span><span class="o">.</span><span class="n">values</span>
<span class="p">})</span>

<span class="c1">### 5th step: assign the nearest hospital to the related cluster</span>
<span class="c1"># distances between each cluster center and each health facility center</span>
<span class="n">distances</span> <span class="o">=</span> <span class="n">cdist</span><span class="p">(</span><span class="n">cluster_centers</span><span class="p">,</span> <span class="n">hospital_coords</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">)</span>

<span class="c1"># the index of the nearest hospital for each cluster</span>
<span class="n">nearest_hospital_idx</span> <span class="o">=</span> <span class="n">distances</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># assign the nearest hospital Local_ID and geometry to each cluster center</span>
<span class="n">clusters_df</span><span class="p">[</span><span class="s1">&#39;nearest_hospital_local_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">hospital_local_ids</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">nearest_hospital_idx</span><span class="p">]</span>
<span class="n">clusters_df</span><span class="p">[</span><span class="s1">&#39;nearest_hospital_geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">hospital_geometries</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">nearest_hospital_idx</span><span class="p">]</span>

<span class="c1">### 6th step: convert to GeoDataFrame and set CRS</span>
<span class="n">clusters_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">clusters_df</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">)</span>
<span class="n">clusters_gdf</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># review the content of the resulting clusters dataframe</span>
<span class="n">clusters_gdf</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cluster</th>
      <th>geometry</th>
      <th>urban_population</th>
      <th>rural_population</th>
      <th>nearest_hospital_local_id</th>
      <th>nearest_hospital_geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>POINT (15.36305 45.4589)</td>
      <td>0.000000</td>
      <td>155.921677</td>
      <td>73</td>
      <td>POINT (15.163850749114253 45.79989695241292)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>POINT (15.99472 46.75537)</td>
      <td>3826.316650</td>
      <td>13469.583984</td>
      <td>2</td>
      <td>POINT (15.978238324664575 46.68750277238846)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>POINT (15.27769 45.4589)</td>
      <td>0.000000</td>
      <td>1046.664062</td>
      <td>73</td>
      <td>POINT (15.163850749114253 45.79989695241292)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>POINT (14.50945 45.97066)</td>
      <td>10871.824219</td>
      <td>0.000000</td>
      <td>4</td>
      <td>POINT (14.523534544937489 46.03654961029273)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>POINT (14.21922 46.38007)</td>
      <td>20575.242188</td>
      <td>13451.051758</td>
      <td>5</td>
      <td>POINT (14.201134898326943 46.376751864014345)</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>128</th>
      <td>128</td>
      <td>POINT (14.50945 46.35449)</td>
      <td>0.000000</td>
      <td>1238.608643</td>
      <td>129</td>
      <td>POINT (14.486722993533334 46.24971688580778)</td>
    </tr>
    <tr>
      <th>129</th>
      <td>129</td>
      <td>POINT (13.78389 46.43978)</td>
      <td>0.000000</td>
      <td>3545.973633</td>
      <td>130</td>
      <td>POINT (13.782413390607312 46.48538871591214)</td>
    </tr>
    <tr>
      <th>130</th>
      <td>130</td>
      <td>POINT (14.38141 46.43978)</td>
      <td>0.000000</td>
      <td>5411.233398</td>
      <td>131</td>
      <td>POINT (14.332917646680235 46.32902384898702)</td>
    </tr>
    <tr>
      <th>131</th>
      <td>131</td>
      <td>POINT (14.33873 46.22654)</td>
      <td>47305.285156</td>
      <td>29385.140625</td>
      <td>132</td>
      <td>POINT (14.353454222758952 46.24864076461883)</td>
    </tr>
    <tr>
      <th>132</th>
      <td>132</td>
      <td>POINT (13.91193 45.50154)</td>
      <td>0.000000</td>
      <td>2524.853027</td>
      <td>43</td>
      <td>POINT (13.732211026809601 45.53942988832533)</td>
    </tr>
  </tbody>
</table>
<p>133 rows × 6 columns</p>
</div></div></div>
</div>
</section>
<section id="explore-and-evaluate-baseline-results">
<h2>5. Explore and evaluate baseline results<a class="headerlink" href="#explore-and-evaluate-baseline-results" title="Permalink to this heading">#</a></h2>
<p>let’s Plot cluster centers and the location of hospitals</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clusters_gdf</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clusters_gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span>
<span class="n">clusters_gdf</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clusters_gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">y</span>


<span class="n">HealthCenters_centroids</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HealthCenters_centroids</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span>
<span class="n">HealthCenters_centroids</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HealthCenters_centroids</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">y</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>


<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">clusters_gdf</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">clusters_gdf</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cluster Centers&#39;</span><span class="p">)</span>


<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">clusters_gdf</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">clusters_gdf</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">clusters_gdf</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">HealthCenters_centroids</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">HealthCenters_centroids</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Hospitals&#39;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Cluster Centers with their IDs and Hospital Locations&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Longitude&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Latitude&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><img alt="../_images/5a6d2ad9aabc15ac38d0e0615d2639be830a590336fd7d2c471952688867a33a.png" src="../_images/5a6d2ad9aabc15ac38d0e0615d2639be830a590336fd7d2c471952688867a33a.png" />
</div>
</div>
<section id="identify-and-plot-population-per-healthcare-facility">
<h3>Identify and plot population per healthcare facility<a class="headerlink" href="#identify-and-plot-population-per-healthcare-facility" title="Permalink to this heading">#</a></h3>
<p>Here, we calculate the urban and rural demand for services for each hospital by summing the populations in each cluster assigned to the hospitals. We also calculate the total demand for each hospital.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculateing the total rural and urban demand (population) of each hospital</span>
<span class="n">hospital_population</span> <span class="o">=</span> <span class="n">clusters_gdf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;nearest_hospital_local_id&#39;</span><span class="p">)[[</span><span class="s1">&#39;urban_population&#39;</span><span class="p">,</span> <span class="s1">&#39;rural_population&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># now we merge the population data back to the HealthCenters_centroids GeoDataFrame</span>
<span class="n">hospital_population_merged</span> <span class="o">=</span> <span class="n">HealthCenters_centroids</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">hospital_population</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;Local_ID&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;nearest_hospital_local_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="c1"># also we sum up rural and urban demand to get the total demand of each hospital as well</span>
<span class="n">hospital_population_merged</span><span class="p">[</span><span class="s1">&#39;total_population&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hospital_population_merged</span><span class="p">[</span><span class="s1">&#39;urban_population&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">hospital_population_merged</span><span class="p">[</span><span class="s1">&#39;rural_population&#39;</span><span class="p">]</span>

<span class="c1"># display the demand of hospitals</span>
<span class="n">hospital_population_merged</span><span class="p">[[</span><span class="s1">&#39;Local_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;urban_population&#39;</span><span class="p">,</span> <span class="s1">&#39;rural_population&#39;</span><span class="p">,</span> <span class="s1">&#39;total_population&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;total_population&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Local_ID</th>
      <th>urban_population</th>
      <th>rural_population</th>
      <th>total_population</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>38</th>
      <td>39</td>
      <td>167343.843750</td>
      <td>0.000000</td>
      <td>167343.843750</td>
    </tr>
    <tr>
      <th>48</th>
      <td>49</td>
      <td>46885.500000</td>
      <td>70193.351562</td>
      <td>117078.851562</td>
    </tr>
    <tr>
      <th>25</th>
      <td>26</td>
      <td>76068.718750</td>
      <td>11647.865234</td>
      <td>87716.585938</td>
    </tr>
    <tr>
      <th>16</th>
      <td>17</td>
      <td>66169.156250</td>
      <td>20895.769531</td>
      <td>87064.921875</td>
    </tr>
    <tr>
      <th>131</th>
      <td>132</td>
      <td>47305.285156</td>
      <td>29385.140625</td>
      <td>76690.421875</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>101</th>
      <td>102</td>
      <td>0.000000</td>
      <td>3403.614990</td>
      <td>3403.614990</td>
    </tr>
    <tr>
      <th>121</th>
      <td>122</td>
      <td>2615.232422</td>
      <td>354.383392</td>
      <td>2969.615723</td>
    </tr>
    <tr>
      <th>40</th>
      <td>41</td>
      <td>0.000000</td>
      <td>2423.224854</td>
      <td>2423.224854</td>
    </tr>
    <tr>
      <th>108</th>
      <td>109</td>
      <td>0.000000</td>
      <td>1852.280396</td>
      <td>1852.280396</td>
    </tr>
    <tr>
      <th>128</th>
      <td>129</td>
      <td>0.000000</td>
      <td>1437.886475</td>
      <td>1437.886475</td>
    </tr>
  </tbody>
</table>
<p>77 rows × 4 columns</p>
</div></div></div>
</div>
<p>hospital_population_merged.plot(‘population’)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hospital_population_merged</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;osm_id&#39;, &#39;osm_way_id&#39;, &#39;name&#39;, &#39;type&#39;, &#39;aeroway&#39;, &#39;amenity&#39;,
       &#39;admin_level&#39;, &#39;barrier&#39;, &#39;boundary&#39;, &#39;building&#39;, &#39;craft&#39;, &#39;geological&#39;,
       &#39;historic&#39;, &#39;land_area&#39;, &#39;landuse&#39;, &#39;leisure&#39;, &#39;man_made&#39;, &#39;military&#39;,
       &#39;natural&#39;, &#39;office&#39;, &#39;place&#39;, &#39;shop&#39;, &#39;sport&#39;, &#39;tourism&#39;, &#39;other_tags&#39;,
       &#39;geometry&#39;, &#39;Local_ID&#39;, &#39;x&#39;, &#39;y&#39;, &#39;nearest_hospital_local_id&#39;,
       &#39;urban_population&#39;, &#39;rural_population&#39;, &#39;total_population&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>


<span class="n">hospital_population_merged</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">column</span><span class="o">=</span><span class="s1">&#39;total_population&#39;</span><span class="p">,</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
    <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s2">&quot;Total Population&quot;</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">},</span>
    <span class="n">markersize</span><span class="o">=</span><span class="n">hospital_population_merged</span><span class="p">[</span><span class="s1">&#39;total_population&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span> <span class="p">,</span> 
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis_r&#39;</span><span class="p">,</span>
    <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span> 
<span class="p">)</span>


<span class="c1"># Add a title and labels to the axes</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Hospital locations and their total demand&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Show the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
</pre></div>
</div>
<img alt="../_images/b9f97b9347a386b2eaa961ed712e84a40d0ebe06b4eeaf55f01e6e0789b629e1.png" src="../_images/b9f97b9347a386b2eaa961ed712e84a40d0ebe06b4eeaf55f01e6e0789b629e1.png" />
</div>
</div>
<p>Now we check if there is any hospital that has not been assigned to any population cluster.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">assigned_hospitals</span> <span class="o">=</span> <span class="n">clusters_gdf</span><span class="p">[</span><span class="s1">&#39;nearest_hospital_local_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

<span class="n">unassigned_hospitals</span> <span class="o">=</span> <span class="n">HealthCenters_centroids</span><span class="p">[</span><span class="o">~</span><span class="n">HealthCenters_centroids</span><span class="p">[</span><span class="s1">&#39;Local_ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">assigned_hospitals</span><span class="p">)]</span>

<span class="k">if</span> <span class="n">unassigned_hospitals</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All hospitals are assigned to at least one cluster.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;following hospitals are not assigned to any cluster:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">unassigned_hospitals</span><span class="p">[[</span><span class="s1">&#39;Local_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>following hospitals are not assigned to any cluster:
     Local_ID                   geometry
0           1  POINT (14.52441 46.05365)
2           3  POINT (14.52484 46.06755)
6           7  POINT (14.48788 46.06866)
7           8  POINT (14.48717 46.06762)
8           9  POINT (14.52093 46.05413)
9          10   POINT (14.5237 46.05333)
10         11  POINT (14.52078 46.05266)
11         12  POINT (14.52033 46.05172)
13         14  POINT (14.56972 46.05215)
21         22  POINT (14.52243 46.05235)
22         23  POINT (14.52138 46.05506)
23         24  POINT (14.51099 46.06451)
26         27  POINT (15.87645 46.42654)
28         29   POINT (14.5239 46.05406)
29         30  POINT (14.52124 46.05119)
30         31   POINT (14.5225 46.05157)
31         32  POINT (14.52194 46.05188)
32         33  POINT (14.52217 46.05327)
33         34  POINT (14.52236 46.05607)
34         35  POINT (14.51737 46.05131)
37         38  POINT (14.52526 46.05426)
39         40  POINT (14.52839 46.05496)
43         44   POINT (14.4811 46.04615)
44         45  POINT (14.53185 46.10335)
45         46  POINT (14.53148 46.05589)
46         47  POINT (14.50068 46.06068)
47         48  POINT (14.51968 46.05196)
49         50   POINT (15.08172 46.5083)
51         52   POINT (14.55865 46.0535)
52         53  POINT (14.57055 46.05288)
53         54  POINT (14.57102 46.05314)
54         55  POINT (14.57156 46.05365)
55         56  POINT (14.57166 46.05253)
56         57  POINT (14.57013 46.05332)
62         63  POINT (15.67162 46.52356)
67         68  POINT (14.46488 46.09857)
73         74  POINT (15.16206 45.80063)
79         80   POINT (14.48296 46.0712)
80         81  POINT (14.59646 46.13959)
81         82  POINT (14.51998 46.05327)
82         83  POINT (14.52931 46.05476)
83         84  POINT (14.50254 46.06452)
84         85  POINT (15.64027 46.23881)
89         90  POINT (13.64537 45.95796)
92         93    POINT (14.35333 46.249)
96         97  POINT (15.08171 46.50819)
97         98  POINT (14.35409 46.24867)
112       113  POINT (14.48694 46.04654)
113       114  POINT (14.52171 46.05584)
114       115  POINT (14.48726 46.06773)
119       120  POINT (16.14167 46.40654)
122       123   POINT (13.68777 45.5443)
123       124  POINT (14.35315 46.27635)
124       125   POINT (14.5258 46.05186)
127       128     POINT (14.487 46.0465)
132       133  POINT (14.10892 46.37141)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="natural-hazard-disruption">
<h2>6. Natural hazard disruption<a class="headerlink" href="#natural-hazard-disruption" title="Permalink to this heading">#</a></h2>
<section id="download-flood-data">
<h3>Download flood data<a class="headerlink" href="#download-flood-data" title="Permalink to this heading">#</a></h3>
<p>The flood data we will extract from a repository maintained by the World Resources Institute. We will download river flood hazard maps from their <a class="reference external" href="https://wri-projects.s3.amazonaws.com/AqueductFloodTool/download/v2/index.html">Flood Data Collection</a>.</p>
<p>Here we do not need to use an API and we also do not need to register ourselves, so we can download any of the files directly. In case you do not have any flood impacts. You could select a more extreme future scenario. But let’s first download the 1/1000 river flood event under historic conditions.</p>
</section>
<section id="overlay-flood-data-with-hospitals">
<h3>Overlay flood data with Hospitals<a class="headerlink" href="#overlay-flood-data-with-hospitals" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flood_map_path</span> <span class="o">=</span> <span class="s2">&quot;https://wri-projects.s3.amazonaws.com/AqueductFloodTool/download/v2/inunriver_historical_000000000WATCH_1980_rp01000.tif&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flood_map</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">flood_map_path</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;rasterio&quot;</span><span class="p">)</span>
<span class="n">flood_map</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt; Size: 4GB
Dimensions:      (band: 1, x: 43200, y: 21600)
Coordinates:
  * band         (band) int32 4B 1
  * x            (x) float64 346kB -180.0 -180.0 -180.0 ... 180.0 180.0 180.0
  * y            (y) float64 173kB 90.0 89.99 89.98 ... -89.98 -89.99 -90.0
    spatial_ref  int32 4B ...
Data variables:
    band_data    (band, y, x) float32 4GB ...</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-a83e22e4-21e9-4def-a4d3-2c76753b37af' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-a83e22e4-21e9-4def-a4d3-2c76753b37af' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>band</span>: 1</li><li><span class='xr-has-index'>x</span>: 43200</li><li><span class='xr-has-index'>y</span>: 21600</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-9f4070f8-89e2-49f7-b953-77edc8335b5d' class='xr-section-summary-in' type='checkbox'  checked><label for='section-9f4070f8-89e2-49f7-b953-77edc8335b5d' class='xr-section-summary' >Coordinates: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>band</span></div><div class='xr-var-dims'>(band)</div><div class='xr-var-dtype'>int32</div><div class='xr-var-preview xr-preview'>1</div><input id='attrs-8d23b35d-3fed-4c0a-a7dc-e55d1b97fcac' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-8d23b35d-3fed-4c0a-a7dc-e55d1b97fcac' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f4a82293-0a7b-4068-af5f-fce312187b5c' class='xr-var-data-in' type='checkbox'><label for='data-f4a82293-0a7b-4068-af5f-fce312187b5c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>x</span></div><div class='xr-var-dims'>(x)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-180.0 -180.0 ... 180.0 180.0</div><input id='attrs-29587ec8-c7eb-48fe-bb0e-ae2cb4637ebd' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-29587ec8-c7eb-48fe-bb0e-ae2cb4637ebd' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-69ab63f1-224f-4ed5-905d-c087bfce0e80' class='xr-var-data-in' type='checkbox'><label for='data-69ab63f1-224f-4ed5-905d-c087bfce0e80' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([-179.995833, -179.9875  , -179.979167, ...,  179.979167,  179.9875  ,
        179.995833])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>y</span></div><div class='xr-var-dims'>(y)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>90.0 89.99 89.98 ... -89.99 -90.0</div><input id='attrs-cb9138f6-b914-4f21-a656-f408bb80d980' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-cb9138f6-b914-4f21-a656-f408bb80d980' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4067f123-9497-4107-9313-6ed40eb37b69' class='xr-var-data-in' type='checkbox'><label for='data-4067f123-9497-4107-9313-6ed40eb37b69' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 89.995833,  89.9875  ,  89.979167, ..., -89.979167, -89.9875  ,
       -89.995833])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>spatial_ref</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int32</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-bebabe04-4ad4-469a-9429-5e9deb0f3aa8' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-bebabe04-4ad4-469a-9429-5e9deb0f3aa8' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4b603495-9840-48ae-810e-2369af019cc3' class='xr-var-data-in' type='checkbox'><label for='data-4b603495-9840-48ae-810e-2369af019cc3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>crs_wkt :</span></dt><dd>GEOGCS[&quot;WGS 84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS 84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0,AUTHORITY[&quot;EPSG&quot;,&quot;8901&quot;]],UNIT[&quot;degree&quot;,0.0174532925199433,AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],AXIS[&quot;Latitude&quot;,NORTH],AXIS[&quot;Longitude&quot;,EAST],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]</dd><dt><span>semi_major_axis :</span></dt><dd>6378137.0</dd><dt><span>semi_minor_axis :</span></dt><dd>6356752.314245179</dd><dt><span>inverse_flattening :</span></dt><dd>298.257223563</dd><dt><span>reference_ellipsoid_name :</span></dt><dd>WGS 84</dd><dt><span>longitude_of_prime_meridian :</span></dt><dd>0.0</dd><dt><span>prime_meridian_name :</span></dt><dd>Greenwich</dd><dt><span>geographic_crs_name :</span></dt><dd>WGS 84</dd><dt><span>horizontal_datum_name :</span></dt><dd>World Geodetic System 1984</dd><dt><span>grid_mapping_name :</span></dt><dd>latitude_longitude</dd><dt><span>spatial_ref :</span></dt><dd>GEOGCS[&quot;WGS 84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS 84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0,AUTHORITY[&quot;EPSG&quot;,&quot;8901&quot;]],UNIT[&quot;degree&quot;,0.0174532925199433,AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],AXIS[&quot;Latitude&quot;,NORTH],AXIS[&quot;Longitude&quot;,EAST],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]</dd><dt><span>GeoTransform :</span></dt><dd>-180.0 0.008333333333333333 0.0 90.0 0.0 -0.008333333333333333</dd></dl></div><div class='xr-var-data'><pre>[1 values with dtype=int32]</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-73aa3f76-6f8e-4d66-8ca6-cc278e6f4ff8' class='xr-section-summary-in' type='checkbox'  checked><label for='section-73aa3f76-6f8e-4d66-8ca6-cc278e6f4ff8' class='xr-section-summary' >Data variables: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>band_data</span></div><div class='xr-var-dims'>(band, y, x)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-fa128d1a-141a-44be-871e-6762bebf1816' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-fa128d1a-141a-44be-871e-6762bebf1816' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9cd3dea3-3a8b-4963-b842-8f67625a8037' class='xr-var-data-in' type='checkbox'><label for='data-9cd3dea3-3a8b-4963-b842-8f67625a8037' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>AREA_OR_POINT :</span></dt><dd>Area</dd></dl></div><div class='xr-var-data'><pre>[933120000 values with dtype=float32]</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-dd7eecb6-a217-4a3f-98ff-ecf25c602f6c' class='xr-section-summary-in' type='checkbox'  ><label for='section-dd7eecb6-a217-4a3f-98ff-ecf25c602f6c' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>band</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-f0daa577-989f-4634-84f4-2c2b6c89e574' class='xr-index-data-in' type='checkbox'/><label for='index-f0daa577-989f-4634-84f4-2c2b6c89e574' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([1], dtype=&#x27;int32&#x27;, name=&#x27;band&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>x</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-460ecab8-a8a2-457a-884b-d10775be7113' class='xr-index-data-in' type='checkbox'/><label for='index-460ecab8-a8a2-457a-884b-d10775be7113' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([-179.99583333333334,           -179.9875, -179.97916666666666,
       -179.97083333333333,           -179.9625, -179.95416666666668,
       -179.94583333333333,           -179.9375, -179.92916666666667,
       -179.92083333333335,
       ...
        179.92083333333335,  179.92916666666667,            179.9375,
        179.94583333333333,  179.95416666666665,  179.96249999999998,
         179.9708333333333,  179.97916666666669,            179.9875,
        179.99583333333334],
      dtype=&#x27;float64&#x27;, name=&#x27;x&#x27;, length=43200))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>y</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-3c25caf4-f0b6-4a83-b015-62743946d5f0' class='xr-index-data-in' type='checkbox'/><label for='index-3c25caf4-f0b6-4a83-b015-62743946d5f0' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([ 89.99583333333334,            89.9875,  89.97916666666667,
        89.97083333333333,            89.9625,  89.95416666666667,
        89.94583333333334,            89.9375,  89.92916666666667,
        89.92083333333333,
       ...
       -89.92083333333332, -89.92916666666667,           -89.9375,
       -89.94583333333333, -89.95416666666665,           -89.9625,
       -89.97083333333333, -89.97916666666666, -89.98749999999998,
       -89.99583333333334],
      dtype=&#x27;float64&#x27;, name=&#x27;y&#x27;, length=21600))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-780647c4-e5fe-4121-872e-308329b807e8' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-780647c4-e5fe-4121-872e-308329b807e8' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div></div>
</div>
<p>As you can see, this is a very large dataset again. Let’s make our life a little bit more relaxed by clipping the map to our country of interest.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">min_lon</span> <span class="o">=</span>  <span class="n">country_geom</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">minx</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">min_lat</span> <span class="o">=</span> <span class="n">country_geom</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">miny</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#complete function</span>
<span class="n">max_lon</span> <span class="o">=</span>  <span class="n">country_geom</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">maxx</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#complete function</span>
<span class="n">max_lat</span> <span class="o">=</span>  <span class="n">country_geom</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">maxy</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="c1">#complete function</span>

<span class="n">flood_map_area</span> <span class="o">=</span> <span class="n">flood_map</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">clip_box</span><span class="p">(</span><span class="n">minx</span><span class="o">=</span><span class="n">min_lon</span><span class="p">,</span><span class="n">miny</span><span class="o">=</span><span class="n">min_lat</span><span class="p">,</span><span class="n">maxx</span><span class="o">=</span><span class="n">max_lon</span><span class="p">,</span><span class="n">maxy</span><span class="o">=</span><span class="n">max_lat</span><span class="p">)</span> <span class="c1">#complete function</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flood_map_area</span><span class="o">.</span><span class="n">band_data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x2795c5a3bf0&gt;
</pre></div>
</div>
<img alt="../_images/1017e9583d701bfc9d3798f95e578f797ca99d4188d182300584b312b8b7c2ca.png" src="../_images/1017e9583d701bfc9d3798f95e578f797ca99d4188d182300584b312b8b7c2ca.png" />
</div>
</div>
</section>
<section id="overlay-flood-data-with-healthcare-facilities">
<h3>Overlay flood data with healthcare facilities<a class="headerlink" href="#overlay-flood-data-with-healthcare-facilities" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_get_damage_per_object</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span> <span class="n">curves</span><span class="p">,</span> <span class="n">cell_area_m2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate damage for a given asset based on hazard information.</span>
<span class="sd">    Arguments:</span>
<span class="sd">        *asset*: Tuple containing information about the asset. It includes:</span>
<span class="sd">            - Index or identifier of the asset (asset[0]).</span>
<span class="sd">            - Asset-specific information, including hazard points (asset[1][&#39;hazard_point&#39;]).</span>
<span class="sd">        *maxdam_dict*: Maximum damage value.</span>
<span class="sd">    Returns:</span>
<span class="sd">        *tuple*: A tuple containing the asset index or identifier and the calculated damage.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">asset</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">geom_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Polygon&quot;</span><span class="p">,</span> <span class="s2">&quot;MultiPolygon&quot;</span><span class="p">):</span>
        <span class="n">coverage</span> <span class="o">=</span> <span class="n">asset</span><span class="p">[</span><span class="s2">&quot;coverage&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">cell_area_m2</span>
    <span class="k">elif</span> <span class="n">asset</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">geom_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;LineString&quot;</span><span class="p">,</span> <span class="s2">&quot;MultiLineString&quot;</span><span class="p">):</span>
        <span class="n">coverage</span> <span class="o">=</span> <span class="n">asset</span><span class="p">[</span><span class="s2">&quot;coverage&quot;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">asset</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">geom_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Point&quot;</span><span class="p">):</span>
        <span class="n">coverage</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Geometry type </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">geom_type</span><span class="si">}</span><span class="s2"> not supported&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
                <span class="n">asset</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">],</span> <span class="n">curves</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">curves</span><span class="p">[</span><span class="n">asset</span><span class="p">[</span><span class="s2">&quot;amenity&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
            <span class="p">)</span>
            <span class="o">*</span> <span class="n">coverage</span>
        <span class="p">)</span>
        <span class="o">*</span> <span class="n">asset</span><span class="p">[</span><span class="s2">&quot;maximum_damage&quot;</span><span class="p">]</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maxdam</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;hospital&quot;</span><span class="p">:</span><span class="mi">2000</span><span class="p">,</span>
        <span class="s2">&quot;clinic&quot;</span><span class="p">:</span><span class="mi">1500</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">curves</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mf">0.2</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mf">0.4</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">150</span><span class="p">,</span><span class="mf">0.6</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">200</span><span class="p">,</span><span class="mf">0.8</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">250</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>

<span class="n">curves</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">curves</span><span class="p">,</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">curves</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">maxdam</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)))),</span>
                           <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">curves</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">curves</span><span class="p">)</span>
<span class="n">curves</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;depth&#39;</span><span class="p">]</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">maxdam</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">curves</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;depth&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">values_and_coverage_per_object</span> <span class="o">=</span> <span class="n">exact_extract</span><span class="p">(</span>
            <span class="n">flood_map</span><span class="p">,</span>
            <span class="n">HealthCenters</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">4326</span><span class="p">),</span>
            <span class="p">[</span><span class="s2">&quot;coverage&quot;</span><span class="p">,</span> <span class="s2">&quot;values&quot;</span><span class="p">],</span>
            <span class="n">output</span><span class="o">=</span><span class="s2">&quot;pandas&quot;</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">values_and_coverage_per_object</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coverage</th>
      <th>values</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[0.0031160966027528048]</td>
      <td>[0.0]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[0.008566441014409065]</td>
      <td>[0.31174808740615845]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[0.012850387953221798, 0.008853942155838013, 0...</td>
      <td>[0.0, 0.0, 0.0, 0.0]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>[0.00234486092813313]</td>
      <td>[0.0]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>[0.00516355037689209]</td>
      <td>[0.0]</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>128</th>
      <td>[0.0008400809019804001]</td>
      <td>[0.0]</td>
    </tr>
    <tr>
      <th>129</th>
      <td>[0.0007367293583229184]</td>
      <td>[0.0]</td>
    </tr>
    <tr>
      <th>130</th>
      <td>[0.00482288608327508, 0.0020372953731566668]</td>
      <td>[0.0, 0.0]</td>
    </tr>
    <tr>
      <th>131</th>
      <td>[0.0023558475077152252]</td>
      <td>[0.0]</td>
    </tr>
    <tr>
      <th>132</th>
      <td>[0.002978724194690585]</td>
      <td>[0.0]</td>
    </tr>
  </tbody>
</table>
<p>133 rows × 2 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">HealthCenters</span> <span class="o">=</span> <span class="n">HealthCenters</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">values_and_coverage_per_object</span><span class="p">,</span><span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">HealthCenters</span><span class="p">[</span><span class="s1">&#39;maximum_damage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HealthCenters</span><span class="o">.</span><span class="n">amenity</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">maxdam</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">HealthCenters</span><span class="p">[</span><span class="s1">&#39;damage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HealthCenters</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">_object</span><span class="p">:</span> <span class="n">_get_damage_per_object</span><span class="p">(</span><span class="n">_object</span><span class="p">,</span> <span class="n">curves</span><span class="p">,</span> <span class="n">cell_area_m2</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">HealthCenters</span><span class="p">[</span><span class="s1">&#39;damage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0         0.000000
93        0.000000
92        0.000000
91        0.000000
90        0.000000
          ...     
76       86.627588
41      148.154755
1       160.234296
120     326.382010
12     2793.266143
Name: damage, Length: 133, dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="your-final-task">
<h1>7. Your Final Task<a class="headerlink" href="#your-final-task" title="Permalink to this heading">#</a></h1>
<p>As you saw, due to a flood with a 1000-year return period, some hospitals may be out of service. Therefore, we need to estimate the post-flood urban/rural demand for services from the hospitals that remain operational.</p>
<section id="your-task-here-will-be">
<h2>Your task here will be:<a class="headerlink" href="#your-task-here-will-be" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Create new clusters of populations and assign them to the remaining hospitals, then determine the post-disaster demand for these hospitals.</p></li>
<li><p>Calcuate the urban, rural and total demand (population in need of services) for each hospital.</p></li>
<li><p>Plot the remaining hospitals vs their total population in need of service.</p></li>
<li><p>Let us know how many hospitals were affected by the flood and the total number of rural residents who need to find an alternative hospital.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./TAA4"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../TAA3/tutorial.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Tutorial 3: Accessing web-hosted geo-data and clustering</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">TAA4: Accessibility to healthcare facilities</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#important-before-we-start">Important before we start</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-objectives">Learning Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prepare-the-packages">Prepare the packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-download-and-preparation">2. Data download and preparation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#classification-of-rural-and-urban-areas">3. Classification of rural and urban areas</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up">Set-up</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-training-validation-data">Set-up training &amp; validation data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-image-variables-to-include">Calculate image variables to include</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-clc2018-and-sample-data">Load CLC2018 and sample data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optimize-on-training-validation-set">Optimize on training &amp; validation set</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#run-on-test-set">Run on test set</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#export-resulting-image">Export resulting image</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#overlay-urban-and-rural-classification-with-population-and-healthcare-information">3. Overlay urban and rural classification with population and Healthcare information</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#clustering-population-data-points-and-assigning-them-to-their-nearest-hospital">4. Clustering population data points and assigning them to their nearest hospital.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#explore-and-evaluate-baseline-results">5. Explore and evaluate baseline results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#identify-and-plot-population-per-healthcare-facility">Identify and plot population per healthcare facility</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#natural-hazard-disruption">6. Natural hazard disruption</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-flood-data">Download flood data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#overlay-flood-data-with-hospitals">Overlay flood data with Hospitals</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#overlay-flood-data-with-healthcare-facilities">Overlay flood data with healthcare facilities</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#your-final-task">7. Your Final Task</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#your-task-here-will-be">Your task here will be:</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dr Elco Koks & Dr Alex Levering
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>